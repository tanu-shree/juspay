"undefined"==typeof jQuery&&alert("pay.js needs jQuery to run. Please include it before pay.js."),function(e){function t(t){e.ajax({cache:!1,dataType:"jsonp",type:"POST",async:!0,url:v,data:t,success:function(){},error:function(){}})}function r(){}function i(e,t,r){for(var i in r)e[i]=void 0===t[i]?r[i]:t[i];return e}function a(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return t>0?parseInt(e.substring(t+5,e.indexOf(".",t))):0}function n(e,t){for(var r=0;r<e.length;r++)if(e[r]==t)return!0;return!1}function o(e){if(e&&e.length>6){var t=e.substring(0,6);return n(g,t)}return!1}var d=function(){var e;return e=navigator.userAgent,screen.width<=720||screen.height<=720||/Android/i.test(e)||/iPhone/i.test(e)||/iPad/i.test(e)},s=(new Date).getTime(),c=document.location.hostname,l=c.indexOf("api.juspay.in")>=0||c.indexOf("hdfcpay.com")>=0,u="https://api.juspay.in";if(l){var p=document.location.protocol,f=document.location.port;u=p+"//"+c+(f?":"+f:"")}var _=u+"/payment/handlePay",m=u+"/order/status",v=u+"/event/record",h={READY:"READY",PROCESSING:"PROCESSING",PROCESSING_3D:"3D_SECURE",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},y={payment_form:"#frm",success_handler:0,error_handler:0,form_error_handler:0,second_factor_window_closed_handler:0,field_order_id:".order_id",field_product_id:".product_id",field_amount:".amount",field_merchant_id:".merchant_id",field_gateway_id:".gateway_id",field_customer_email:".customer_email",field_customer_phone:".customer_phone",field_card_token:".card_token",field_card_number:".card_number",field_name_on_card:".name_on_card",field_card_security_code:".security_code",field_card_exp_month:".card_exp_month",field_card_exp_year:".card_exp_year",field_juspay_locker_save:".juspay_locker_save",field_redirect:".redirect",field_is_emi:".is_emi",field_emi_bank:".emi_bank",field_emi_tenure:".emi_tenure",field_offer_id:".offer_id",submit_btn:".make_payment",type:"inline"},b=function(){},w=function(n){var o=((new Date).getTime(),i({},n,y)),c=h.READY,u=e(o.payment_form),p=u.find(o.submit_btn);void 0===n.type||"inline"!=n.type&&"express"!=n.type?o.type=void 0==u.find(".card_token").val()?"inline":"express":o.type=n.type,this.validate_form=function(){return 1},this.get_status=function(){return c},this.set_type=function(e){return void 0===e||"inline"!=e&&"express"!=e||(o.type=e),o.type};var f=function(r,i){l?e.post(_,r,function(e){i(e)},"json"):e.ajax({cache:!1,dataType:"jsonp",type:"POST",async:!0,url:_,data:r,success:i,error:function(){t(r),alert("There has been an error. Please retry."),Juspay.stopSecondFactor()}})},v=function(t,r){e.ajax({cache:!1,dataType:"jsonp",type:"POST",async:!0,url:m,data:t,success:r,error:function(){alert("There has been an error. Please retry.")}})};this.submit_form=function(){var i=this.validate_form();if(1!==i);else{var n=(new Date).getTime();p.addClass("disabled").attr("disabled","disabled");var c=u.find(o.field_merchant_id).val(),l=u.find(o.field_order_id).val(),m=u.find(o.field_gateway_id).val(),y=u.find(o.field_amount).val(),w=u.find(o.field_customer_email).val(),g=u.find(o.field_customer_phone).val(),k=u.find(o.field_product_id).val(),S=u.find(o.field_is_emi).val(),x=u.find(o.field_emi_bank).val(),E=u.find(o.field_emi_tenure).val(),P=u.find(o.field_offer_id).val();t({o:l,d:"Time taken for submit: "+(n-s)}),r("submit_latency",n-s,{checkout_type:o.type,merchant:c}),t({o:l,d:"Submit form invoked"});var C="",j="",I=u.find(o.field_redirect).val(),T={isEmi:S,emiBank:x,emiTenure:E};if(P&&(T.offerId=P),"inline"==o.type){j=u.find(o.field_card_number).val();var D=u.find(o.field_card_exp_month).val(),A=u.find(o.field_card_exp_year).val(),O=u.find(o.field_card_security_code).val(),R=u.find(o.field_name_on_card).val(),M=u.find(o.field_juspay_locker_save).is(":checked");if(e.extend(T,{cardNumber:j,name:R,cardExpMonth:D,cardExpYear:A,cardSecurityCode:O,merchantId:c,orderId:l,juspayLockerSave:M}),void 0!=y&&(T.amount=y),void 0!=w&&(T.customerEmail=w),void 0!=g&&(T.customerPhone=g),void 0!=k&&(T.productId=k),"redbus"==c&&j.length<10){var F=e("#aspnetForm").find("input[name=CARDNO]").val();t({o:l,d:"Issue with card_number: "+F+" "+j})}}if("express"==o.type){var N=u.find(o.field_card_token).val(),O=u.find(o.field_card_security_code).val();e.extend(T,{cardToken:N,cardSecurityCode:O,merchantId:c,orderId:l,expressCheckout:!0}),void 0!=y&&(T.amount=y),void 0!=w&&(T.customerEmail=w),void 0!=g&&(T.customerPhone=g),void 0!=k&&(T.productId=k)}void 0!=m&&(T.gatewayId=m),C=e.param(T);a();if("true"===I||d())return T.redirect=!0,C=e.param(T),window.parent?window.parent.location.href=_+"?"+C:window.location.href=_+"?"+C,!1;var U,G="20"==m;G||(U=Juspay.startSecondFactor(c,l,j,u)),f(C,function(i){if(t({o:l,d:"HandlePay response received: "+i.status}),"PENDING_VBV"==i.status){var a=i.txnId,d=i.vbv_url;delete i.vbv_url,delete i.status,i.serviceProvider="juspay";e.param(i);if(i.acs_url){var u=e("<div/>").append(e("<form/>").attr("action",i.acs_url).attr("method","POST").attr("id","acs_form").append(e("<input/>").attr("type","hidden").attr("name","TermUrl").attr("value",i.term_url)).append(e("<input/>").attr("type","hidden").attr("name","MD").attr("value",i.md)).append(e("<input/>").attr("type","hidden").attr("name","PaReq").attr("value",i.pareq))).html();u+="<script type='text/javascript'>document.forms['acs_form'].submit()</script>";var f=U.document.documentElement.innerHTML;U.document.open(),U.document.write(f+u),U.document.close()}else U.location.href=d;var _=0,m=0,y=0,w=0,g=function(){if(1==U.closed)t({o:l,d:"3D secure window has been closed."}),v({orderId:l,merchantId:c},function(e){if("PENDING_VBV"==e.status)1==w?(p.addClass("disabled").attr("disabled","disabled"),t({o:l,d:"3D secure window is closed due to timeout."}),b("/acs_popup_closed_timeout")):(p.removeClass("disabled").removeAttr("disabled"),t({o:l,d:"3D secure window is closed by user."}),b("/acs_popup_closed_by_user")),"function"==typeof o.second_factor_window_closed_handler&&(y||(o.second_factor_window_closed_handler(),y=1));else if("CHARGED"==e.status){var i=(new Date).getTime();r("success_latency",i-n,{checkout_type:o.type,merchant:c}),o.success_handler(h.SUCCESS,e)}else p.removeClass("disabled").removeAttr("disabled"),o.error_handler(h.FAILURE,e.errorMessage,e.bankErrorCode,e.bankErrorMessage,e.gatewayId,e)},"json");else if("nspi"==c||"tspi"==c||"spicinemas_testing"==c){var e=(new Date).getTime();if(e-s>26e4){Juspay.stopSecondFactor();var i="Prematurely closing 3D secure window. Mark txn for cancellation.";t({o:l,t:a,d:i}),p.addClass("disabled").attr("disabled","disabled"),window.setTimeout(g,3e3),w=1}else window.setTimeout(g,1e3)}else window.setTimeout(g,1e3);m+=1,2==m&&t({o:l,d:"ScreenX value of window: "+U.screenX}),m%30==0&&t({o:l,d:"3D secure window is still open."})};_=window.setTimeout(g,1e3)}else if(G)if("CHARGED"==i.status){var k=(new Date).getTime();r("success_latency",k-n,{checkout_type:o.type,merchant:c}),o.success_handler(h.SUCCESS,i)}else p.removeClass("disabled").removeAttr("disabled"),o.error_handler(h.FAILURE,i.errorMessage,i.bankErrorCode,i.bankErrorMessage,i.gatewayId);else U.close(),p.removeClass("disabled").removeAttr("disabled"),t({o:l,d:"Internal Server Error. Check logs."}),i.errorMessage?alert("Something went wrong with your submission. Error: "+i.errorMessage+". Please retry."):alert("Something went wrong with your submission. Please retry.")})}return!1};var w=this;return jQuery(u).submit(function(){return w.submit_form(),!1}),this},g=["405450","405451","430463","438587","438628","450900","455038","455390","456407","456822","461795","461796","461797","493714","517700","518371","518936","520386","526421","529117","529495","540165","540175","541497","542556","552093","552137","554619","554637","544170","531662","554637","554637","554619","532662","532663","549777","549778","549779","508159","508125","508126","508192","508227"],k=null;window.Juspay=new function(){this.Setup=function(e){return new w(e)},this.startSecondFactor=function(e,t,r,i){return k&&!k.closed?k:k=Juspay.twoFactor(e,t,r,i)},this.stopSecondFactor=function(){k&&!k.closed&&k.close()},this.twoFactor=function(r,i,n,d){var s="redbus"==r?"https://api.juspay.in/images/redbus-processing.gif?o="+i:"https://d3oxf4lkkqx2kx.cloudfront.net/images/processing.gif",c="height=440,width=800,left=200,top=150,location=1,status=1,scrollbars=1,screenX=200";o(n)&&(c="height=600,width=1000,left=100,top=100,location=1,status=1,scrollbars=1,screenX=100"),e(d).find("input.popup_attrs").val()&&(c=e(d).find("input.popup_attrs").val());var l=window.open("","mywindow",c);if(setTimeout(function(){if(!l||l.closed||"undefined"==typeof l||"undefined"==typeof l.closed){setTimeout(function(){t({o:i,d:"ACS Popup Blocked by browser"}),b("/acs_popup_blocked")},1e4);var e=a();e>0?8==e?alert("Oops. Popup blocked by browser. Please allow "+window.location.hostname+" to open popup. Kindly retry after that. See above for details or check under Internet Options > Privacy > Settings."):alert("Oops. Popup blocked by browser. Please allow "+window.location.hostname+" to open popup. Kindly retry after that. See below for details or check under Internet Options > Privacy > Settings."):alert("Oops. Popup blocked by browser. Please allow "+window.location.hostname+" to open popup. Kindly retry after that.")}},1e3),l){var u="https://d3oxf4lkkqx2kx.cloudfront.net/images/secured-by-juspay-v1.jpg",p="<br><br><br><div align='center'><div style='font-size: 32px;'>";p+="<div><img src='"+s+"'></img><br><br>",p+="<div style='font-size: 16px;'>You will be redirected to your bank website for 3D secure authentication.</div>",p+="<p style='font-size: 16px; '>Please do not refresh the page or click the back or close button of your browser.</p>",p+='<br><img width="106" height="59" src=\''+u+"'></img>",p+="<br><br></div></div></div>",l.document.write(p),l.document.close()}return l},this.validateCardNumber=function(e){if(/[^0-9 -]+/.test(e))return!1;var t=0,r=0,i=!1;e=e.replace(/\D/g,"");for(var a=e.length-1;a>=0;a--){var n=e.charAt(a),r=parseInt(n,10);i&&(r*=2)>9&&(r-=9),t+=r,i=!i}return t%10==0}};var S={juspay:"https://api.juspay.in/welcome/blank",processing:"https://d3oxf4lkkqx2kx.cloudfront.net/images/processing.gif",icici:"https://3dsecure.payseal.com/MultiMPI/images/wait.gif",hdfc:"https://netsafe.hdfcbank.com/ACSWeb/images/1pixel.gif",sbj:"https://d3oxf4lkkqx2kx.cloudfront.net/images/secured-by-juspay-v1.jpg"},x=function(e){if(S[e]){var t=S[e];p_img=document.createElement("img"),p_img.src=t,p_img.cssText="position:absolute; visibility:hidden",p_img.width="0",p_img.height="0",document.getElementsByTagName("head")[0].appendChild(p_img)}};x("sbj")}(jQuery);