if(typeof jQuery==="undefined"){alert("pay.js needs jQuery to run. Please include it before pay.js.")}(function(d){var s=function(){var A;A=navigator.userAgent;return(screen.width<=720)||(screen.height<=720)||/Android/i.test(A)||/iPhone/i.test(A)||/iPad/i.test(A)};var p=new Date().getTime();var m=document.location.hostname;var q=(m.indexOf("api.juspay.in")>=0)||(m.indexOf("hdfcpay.com")>=0);var a="https://api.juspay.in";if(q){var n=document.location.protocol;var j=document.location.port;a=n+"//"+m+(j?(":"+j):"")}var i=a+"/payment/handlePay";var o=a+"/order/status";var f=a+"/event/record";var k=a+"/event/addMetric";function y(A){d.ajax({cache:false,dataType:"jsonp",type:"POST",async:true,url:f,data:A,success:function(B){},error:function(C,D,B){}})}function g(C,B,A){}function e(C,D,B){for(var A in B){C[A]=(D[A]===undefined?B[A]:D[A])}return C}var b={READY:"READY",PROCESSING:"PROCESSING",PROCESSING_3D:"3D_SECURE",SUCCESS:"SUCCESS",FAILURE:"FAILURE"};var l={payment_form:"#frm",success_handler:0,error_handler:0,form_error_handler:0,second_factor_window_closed_handler:0,field_order_id:".order_id",field_product_id:".product_id",field_amount:".amount",field_merchant_id:".merchant_id",field_gateway_id:".gateway_id",field_customer_email:".customer_email",field_customer_phone:".customer_phone",field_card_token:".card_token",field_card_number:".card_number",field_name_on_card:".name_on_card",field_card_security_code:".security_code",field_card_exp_month:".card_exp_month",field_card_exp_year:".card_exp_year",field_juspay_locker_save:".juspay_locker_save",field_redirect:".redirect",field_is_emi:".is_emi",field_emi_bank:".emi_bank",field_emi_tenure:".emi_tenure",field_offer_id:".offer_id",submit_btn:".make_payment",type:"inline"};var h=function(A){};var v=function(A){var D=new Date().getTime();var K=e({},A,l);var H=b.READY;var J=d(K.payment_form);var B=J.find(K.submit_btn);if(A.type!==undefined&&(A.type=="inline"||A.type=="express")){K.type=A.type}else{K.type=J.find(".card_token").val()==undefined?"inline":"express"}this.validate_form=function(){return 1};this.get_status=function(){return H};this.set_type=function(L){if(L!==undefined&&(L=="inline"||L=="express")){K.type=L}return K.type};var F=0;var G=0;var I=function(L,M){if(q){d.post(i,L,function(N){M(N)},"json")}else{d.ajax({cache:false,dataType:"jsonp",type:"POST",async:true,url:i,data:L,success:M,error:function(O,P,N){y(L);alert("There has been an error. Please retry.");Juspay.stopSecondFactor()}})}};var C=function(L,M){d.ajax({cache:false,dataType:"jsonp",type:"POST",async:true,url:o,data:L,success:M,error:function(O,P,N){alert("There has been an error. Please retry.")}})};this.submit_form=function(){var ag=this.validate_form();var W=0;if(ag!==1){}else{var S=new Date().getTime();B.addClass("disabled").attr("disabled","disabled");var X=J.find(K.field_merchant_id).val();var ai=J.find(K.field_order_id).val();var ak=J.find(K.field_gateway_id).val();var Q=J.find(K.field_amount).val();var am=J.find(K.field_customer_email).val();var ad=J.find(K.field_customer_phone).val();var aa=J.find(K.field_product_id).val();var af=J.find(K.field_is_emi).val();var P=J.find(K.field_emi_bank).val();var T=J.find(K.field_emi_tenure).val();var O=J.find(K.field_offer_id).val();y({o:ai,d:"Time taken for submit: "+(S-p)});g("submit_latency",(S-p),{checkout_type:K.type,merchant:X});y({o:ai,d:"Submit form invoked"});var al="";var Y="";var ae=J.find(K.field_redirect).val();var V={isEmi:af,emiBank:P,emiTenure:T};if(O){V.offerId=O}if(K.type=="inline"){Y=J.find(K.field_card_number).val();var U=J.find(K.field_card_exp_month).val();var N=J.find(K.field_card_exp_year).val();var ab=J.find(K.field_card_security_code).val();var ah=J.find(K.field_name_on_card).val();var R=J.find(K.field_juspay_locker_save).is(":checked");d.extend(V,{cardNumber:Y,name:ah,cardExpMonth:U,cardExpYear:N,cardSecurityCode:ab,merchantId:X,orderId:ai,juspayLockerSave:R});if(Q!=undefined){V.amount=Q}if(am!=undefined){V.customerEmail=am}if(ad!=undefined){V.customerPhone=ad}if(aa!=undefined){V.productId=aa}if(X=="redbus"&&Y.length<10){var L=d("#aspnetForm").find("input[name=CARDNO]").val();y({o:ai,d:"Issue with card_number: "+L+" "+Y})}}if(K.type=="express"){var Z=J.find(K.field_card_token).val();var ab=J.find(K.field_card_security_code).val();d.extend(V,{cardToken:Z,cardSecurityCode:ab,merchantId:X,orderId:ai,expressCheckout:true});if(Q!=undefined){V.amount=Q}if(am!=undefined){V.customerEmail=am}if(ad!=undefined){V.customerPhone=ad}if(aa!=undefined){V.productId=aa}}if(ak!=undefined){V.gatewayId=ak}al=d.param(V);var M=r();if(ae==="true"||s()){V.redirect=true;al=d.param(V);if(window.parent){window.parent.location.href=i+"?"+al}else{window.location.href=i+"?"+al}return false}else{var aj;var ac=ak=="20";if(!ac){aj=Juspay.startSecondFactor(X,ai,Y,J)}I(al,function(av){y({o:ai,d:"HandlePay response received: "+av.status});if(av.status=="PENDING_VBV"){var ax=av.txnId;var an=av.vbv_url;delete av.vbv_url;delete av.status;av.serviceProvider="juspay";var aq=d.param(av);if(av.acs_url){var au=d("<div/>").append(d("<form/>").attr("action",av.acs_url).attr("method","POST").attr("id","acs_form").append(d("<input/>").attr("type","hidden").attr("name","TermUrl").attr("value",av.term_url)).append(d("<input/>").attr("type","hidden").attr("name","MD").attr("value",av.md)).append(d("<input/>").attr("type","hidden").attr("name","PaReq").attr("value",av.pareq))).html();au+="<script type='text/javascript'>document.forms['acs_form'].submit()<\/script>";var ao=aj.document.documentElement.innerHTML;aj.document.open();aj.document.write(ao+au);aj.document.close()}else{aj.location.href=an}var at=0;var ar=0;var ay=0;var az=0;var aw=function(){if(aj.closed==true){y({o:ai,d:"3D secure window has been closed."});C({orderId:ai,merchantId:X},function(aD){if(aD.status=="PENDING_VBV"){if(az==1){B.addClass("disabled").attr("disabled","disabled");y({o:ai,d:"3D secure window is closed due to timeout."});h("/acs_popup_closed_timeout")}else{B.removeClass("disabled").removeAttr("disabled");y({o:ai,d:"3D secure window is closed by user."});h("/acs_popup_closed_by_user")}if(typeof(K.second_factor_window_closed_handler)=="function"){if(!ay){K.second_factor_window_closed_handler();ay=1}}}else{if(aD.status=="CHARGED"){var aC=new Date().getTime();g("success_latency",(aC-S),{checkout_type:K.type,merchant:X});K.success_handler(b.SUCCESS,aD)}else{B.removeClass("disabled").removeAttr("disabled");K.error_handler(b.FAILURE,aD.errorMessage,aD.bankErrorCode,aD.bankErrorMessage,aD.gatewayId,aD)}}},"json")}else{if(X=="nspi"||X=="tspi"||X=="spicinemas_testing"){var aA=new Date().getTime();if((aA-p)>(260*1000)){Juspay.stopSecondFactor();var aB="Prematurely closing 3D secure window. Mark txn for cancellation.";y({o:ai,t:ax,d:aB});B.addClass("disabled").attr("disabled","disabled");window.setTimeout(aw,3000);az=1}else{window.setTimeout(aw,1000)}}else{window.setTimeout(aw,1000)}}ar=ar+1;if(ar==2){y({o:ai,d:"ScreenX value of window: "+aj.screenX})}if((ar%30)==0){y({o:ai,d:"3D secure window is still open."})}};at=window.setTimeout(aw,1000)}else{if(ac){if(av.status=="CHARGED"){var ap=new Date().getTime();g("success_latency",(ap-S),{checkout_type:K.type,merchant:X});K.success_handler(b.SUCCESS,av)}else{B.removeClass("disabled").removeAttr("disabled");K.error_handler(b.FAILURE,av.errorMessage,av.bankErrorCode,av.bankErrorMessage,av.gatewayId)}}else{aj.close();B.removeClass("disabled").removeAttr("disabled");y({o:ai,d:"Internal Server Error. Check logs."});if(av.errorMessage){alert("Something went wrong with your submission. Error: "+av.errorMessage+". Please retry.")}else{alert("Something went wrong with your submission. Please retry.")}}}})}}return false};var E=this;jQuery(J).submit(function(){E.submit_form();return false});return this};function r(){var B=window.navigator.userAgent;var A=B.indexOf("MSIE ");if(A>0){return parseInt(B.substring(A+5,B.indexOf(".",A)))}else{return 0}}function w(A,C){for(var B=0;B<A.length;B++){if(A[B]==C){return true}}return false}var t=["405450","405451","430463","438587","438628","450900","455038","455390","456407","456822","461795","461796","461797","493714","517700","518371","518936","520386","526421","529117","529495","540165","540175","541497","542556","552093","552137","554619","554637","544170","531662","554637","554637","554619","532662","532663","549777","549778","549779","508159","508125","508126","508192","508227"];function z(B){if(B&&B.length>6){var A=B.substring(0,6);return w(t,A)}else{return false}}var c=null;window.Juspay=new function(){this.Setup=function(A){return new v(A)};this.startSecondFactor=function(C,D,B,A){if(c&&!c.closed){return c}else{c=Juspay.twoFactor(C,D,B,A)}return c};this.stopSecondFactor=function(A){if(c&&!c.closed){c.close()}};this.twoFactor=function(F,J,A,I){var K=F=="redbus"?("https://api.juspay.in/images/redbus-processing.gif?o="+J):"https://d3oxf4lkkqx2kx.cloudfront.net/images/processing.gif";var G="You will be redirected to your bank's website for 3D secure authentication.";var E="Please do not refresh the page or click the back or close button of your browser.";var D="height=440,width=800,left=200,top=150,location=1,status=1,scrollbars=1,screenX=200";if(z(A)){D="height=600,width=1000,left=100,top=100,location=1,status=1,scrollbars=1,screenX=100"}if(d(I).find("input.popup_attrs").val()){D=d(I).find("input.popup_attrs").val()}var H=window.open("","mywindow",D);setTimeout(function(){if(!H||H.closed||typeof H=="undefined"||typeof H.closed=="undefined"){setTimeout(function(){y({o:J,d:"ACS Popup Blocked by browser"});h("/acs_popup_blocked")},10*1000);var L=r();if(L>0){if(L==8){alert("Oops. Popup blocked by browser. Please allow "+window.location.hostname+" to open popup. Kindly retry after that. See above for details or check under Internet Options > Privacy > Settings.")}else{alert("Oops. Popup blocked by browser. Please allow "+window.location.hostname+" to open popup. Kindly retry after that. See below for details or check under Internet Options > Privacy > Settings.")}}else{alert("Oops. Popup blocked by browser. Please allow "+window.location.hostname+" to open popup. Kindly retry after that.")}}},1*1000);if(H){var B="https://d3oxf4lkkqx2kx.cloudfront.net/images/secured-by-juspay-v1.jpg";var C="<br><br><br><div align='center'><div style='font-size: 32px;'>";C+="<div><img src='"+K+"'></img><br><br>";C+="<div style='font-size: 16px;'>You will be redirected to your bank website for 3D secure authentication.</div>";C+="<p style='font-size: 16px; '>Please do not refresh the page or click the back or close button of your browser.</p>";C+='<br><img width="106" height="59" src=\''+B+"'></img>";C+="<br><br></div></div></div>";H.document.write(C);H.document.close()}return H};this.validateCardNumber=function(D){if(/[^0-9 -]+/.test(D)){return false}var E=0,C=0,A=false;D=D.replace(/\D/g,"");for(var F=D.length-1;F>=0;F--){var B=D.charAt(F);var C=parseInt(B,10);if(A){if((C*=2)>9){C-=9}}E+=C;A=!A}return(E%10)==0}};var u={juspay:"https://api.juspay.in/welcome/blank",processing:"https://d3oxf4lkkqx2kx.cloudfront.net/images/processing.gif",icici:"https://3dsecure.payseal.com/MultiMPI/images/wait.gif",hdfc:"https://netsafe.hdfcbank.com/ACSWeb/images/1pixel.gif",sbj:"https://d3oxf4lkkqx2kx.cloudfront.net/images/secured-by-juspay-v1.jpg"};var x=function(B){if(u[B]){var A=u[B];p_img=document.createElement("img");p_img.src=A;p_img.cssText="position:absolute; visibility:hidden";p_img.width="0";p_img.height="0";document.getElementsByTagName("head")[0].appendChild(p_img)}};x("sbj")})(jQuery);